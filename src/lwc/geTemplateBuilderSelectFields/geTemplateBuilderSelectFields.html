<template>
    <div role="grid"
         class="slds-grid slds-wrap">
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="tab is loading"></lightning-spinner>
        </template>
        <div role="panel"
             class="slds-size_3-of-12 slds-p-around_large slds-border_right">
            <h2 class="slds-text-heading_small slds-p-bottom_small">Select Gift Fields</h2>
            <p class="slds-text-body_small slds-p-bottom_small">
                Select the fields to use for entering gifts in this batch template.
                You will only see fields that you have access to and have configured.
                Manage the available objects and fields in
                <a href="#">NPSP Batch Data Import Advanced Mapping</a> in NPSP Settings.
            </p>
            <!-- TODO: Enable when end users are able to create custom field mapping sets -->
            <!--<lightning-combobox name="Field Mapping Set"
                                label="Select Field Mapping Set"
                                options={fieldMappingSetComboboxOptions}
                                value={selectedFieldMappingSet}
                                onchange={handleChangeFieldMappingSet}
                                class="slds-p-bottom_small">
            </lightning-combobox>-->


            <lightning-accordion allow-multiple-sections-open
                                 onsectiontoggle={handleSectionToggle}
                                 active-section-name={activeSections}>

                <template for:each={objectMappings}
                          for:item="objectMapping">

                    <lightning-accordion-section key={objectMapping.DeveloperName}
                                                 name={objectMapping.DeveloperName}
                                                 label={objectMapping.MasterLabel}
                                                 class="slds-truncate slds-accordion__section_extension">

                        <template for:each={objectMapping.fieldMappingCheckboxes}
                                  for:item="fieldMapping">

                            <lightning-input type="checkbox"
                                             key={fieldMapping.value}
                                             label={fieldMapping.label}
                                             value={fieldMapping.value}
                                             checked={fieldMapping.checked}
                                             onchange={handleToggleFieldMapping}
                                             class="slds-truncate slds-p-vertical_xxx-small"
                                             title={fieldMapping.DeveloperName}
                                             data-field-mapping={fieldMapping.value}
                                             data-object-mapping={objectMapping.DeveloperName}>
                            </lightning-input>
                        </template>
                    </lightning-accordion-section>
                </template>
            </lightning-accordion>
        </div>

        <div role="panel"
             class="slds-size_9-of-12 slds-p-around_large slds-border_left">
            <div role="grid"
                 class="slds-grid slds-wrap slds-grid_vertical-align-end">
                <div role="row"
                     class="slds-size_1-of-1">
                    <h2 class="slds-text-heading_small slds-p-bottom_small">Set Gift Field Values</h2>
                    <p class="slds-text-body_small">
                        Mark required select fields and enable default values for user input.
                        Please note that any default values can be overwritten by the gift entry user.
                        Create sections to organize the fields within their object groups,
                        then use the up and down icons to reorder fields as you'd like them to appear on
                        the batch gift entry form.
                    </p>
                </div>
                <div role="row"
                     class="slds-size_1-of-1 slds-p-vertical_large slds-m-vertical_large">
                    <c-ge-template-builder-form-layout form-sections={formSections}
                                                       field-mapping-set={selectedFieldMappingSet}
                                                       onchangeactivesection={handleChangeActiveSection}
                                                       onformsectionup={handleFormSectionUp}
                                                       onformsectiondown={handleFormSectionDown}
                                                       ondeleteformsection={handleDeleteFormSection}
                                                       onformfieldup={handleFormFieldUp}
                                                       onformfielddown={handleFormFieldDown}>
                    </c-ge-template-builder-form-layout>
                </div>
                <div role="row"
                     class="slds-size_1-of-1 slds-p-top_large slds-m-top_large">
                    <div class="slds-float_right">
                        <lightning-button label="Add Section"
                                          title="Add Section"
                                          onclick={handleAddSection}
                                          variant="outline-brand">
                        </lightning-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
